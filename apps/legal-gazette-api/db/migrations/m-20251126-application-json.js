'use strict'

module.exports = {
  up: (queryInterface, Sequelize) => {
    return queryInterface.sequelize.query(`
      BEGIN;

      ALTER TABLE APPLICATION
      DROP COLUMN IF EXISTS TYPE_ID,
      DROP COLUMN IF EXISTS CATEGORY_ID,
      DROP COLUMN IF EXISTS CAPTION,
      DROP COLUMN IF EXISTS ADDITIONAL_TEXT,
      DROP COLUMN IF EXISTS JUDGMENT_DATE,
      DROP COLUMN IF EXISTS HTML,
      DROP COLUMN IF EXISTS SIGNATURE_NAME,
      DROP COLUMN IF EXISTS SIGNATURE_ON_BEHALF_OF,
      DROP COLUMN IF EXISTS SIGNATURE_LOCATION,
      DROP COLUMN IF EXISTS SIGNATURE_DATE,
      DROP COLUMN IF EXISTS LIQUIDATOR_NAME,
      DROP COLUMN IF EXISTS LIQUIDATOR_LOCATION,
      DROP COLUMN IF EXISTS LIQUIDATOR_ON_BEHALF_OF,
      DROP COLUMN IF EXISTS SETTLEMENT_NAME,
      DROP COLUMN IF EXISTS SETTLEMENT_NATIONAL_ID,
      DROP COLUMN IF EXISTS SETTLEMENT_ADDRESS,
      DROP COLUMN IF EXISTS SETTLEMENT_DEADLINE_DATE,
      DROP COLUMN IF EXISTS SETTLEMENT_DATE_OF_DEATH,
      DROP COLUMN IF EXISTS DIVISION_MEETING_DATE,
      DROP COLUMN IF EXISTS DIVISION_MEETING_LOCATION,
      DROP COLUMN IF EXISTS COMMUNICATION_CHANNELS,
      DROP COLUMN IF EXISTS PUBLISHING_DATES,
      DROP COLUMN IF EXISTS COURT_DISTRICT_ID,
      DROP COLUMN IF EXISTS LIQUIDATOR_RECALL_STATEMENT_LOCATION,
      DROP COLUMN IF EXISTS LIQUIDATOR_RECALL_STATEMENT_TYPE,
      ADD COLUMN ANSWERS JSONB DEFAULT '{}'::jsonb,
      ADD COLUMN SETTLEMENT_ID UUID DEFAULT NULL REFERENCES SETTLEMENT(ID);

      ALTER TABLE ADVERT
      ADD COLUMN APPLICATION_ID UUID REFERENCES APPLICATION(ID) DEFAULT NULL;

      CREATE TABLE SIGNATURE (
        ID UUID PRIMARY KEY DEFAULT gen_random_uuid(),
        CREATED_AT TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
        UPDATED_AT TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
        DELETED_AT TIMESTAMPTZ,

        NAME TEXT DEFAULT NULL,
        ON_BEHALF_OF TEXT DEFAULT NULL,
        LOCATION TEXT DEFAULT NULL,
        DATE TIMESTAMPTZ DEFAULT NULL
    );


      COMMIT;
    `)
  },

  down(queryInterface, Sequelize) {
    return queryInterface.sequelize.query(`
      BEGIN;

      ALTER TABLE APPLICATION
      ADD COLUMN TYPE_ID UUID DEFAULT NULL REFERENCES ADVERT_TYPE(ID),
      ADD COLUMN CATEGORY_ID UUID DEFAULT NULL REFERENCES ADVERT_CATEGORY(ID),
      ADD COLUMN CAPTION TEXT DEFAULT NULL,
      ADD COLUMN ADDITIONAL_TEXT TEXT DEFAULT NULL,
      ADD COLUMN JUDGMENT_DATE TIMESTAMPTZ DEFAULT NULL,
      ADD COLUMN HTML TEXT DEFAULT NULL,
      ADD COLUMN SIGNATURE_NAME TEXT DEFAULT NULL,
      ADD COLUMN SIGNATURE_ON_BEHALF_OF TEXT DEFAULT NULL,
      ADD COLUMN SIGNATURE_LOCATION TEXT DEFAULT NULL,
      ADD COLUMN SIGNATURE_DATE TIMESTAMPTZ DEFAULT NULL,
      ADD COLUMN LIQUIDATOR_NAME TEXT DEFAULT NULL,
      ADD COLUMN LIQUIDATOR_LOCATION TEXT DEFAULT NULL,
      ADD COLUMN LIQUIDATOR_ON_BEHALF_OF TEXT DEFAULT NULL,
      ADD COLUMN SETTLEMENT_NAME TEXT DEFAULT NULL,
      ADD COLUMN SETTLEMENT_NATIONAL_ID TEXT DEFAULT NULL,
      ADD COLUMN SETTLEMENT_ADDRESS TEXT DEFAULT NULL,
      ADD COLUMN SETTLEMENT_DEADLINE_DATE TIMESTAMPTZ DEFAULT NULL,
      ADD COLUMN SETTLEMENT_DATE_OF_DEATH TIMESTAMPTZ DEFAULT NULL,
      ADD COLUMN DIVISION_MEETING_DATE TIMESTAMPTZ DEFAULT NULL,
      ADD COLUMN DIVISION_MEETING_LOCATION TEXT DEFAULT NULL,
      ADD COLUMN COMMUNICATION_CHANNELS JSONB DEFAULT '[]'::jsonb,
      ADD COLUMN PUBLISHING_DATES TIMESTAMP WITH TIME ZONE[] DEFAULT array[]::timestamptz[],
      ADD COLUMN COURT_DISTRICT_ID UUID REFERENCES COURT_DISTRICT(ID),
      ADD COLUMN LIQUIDATOR_RECALL_STATEMENT_LOCATION TEXT DEFAULT NULL,
      ADD COLUMN LIQUIDATOR_RECALL_STATEMENT_TYPE TEXT NOT NULL,
      DROP COLUMN IF EXISTS SETTLEMENT_ID,
      DROP COLUMN IF EXISTS ANSWERS;

      ALTER TABLE ADVERT
      DROP COLUMN IF EXISTS APPLICATION_ID;

      DROP TABLE IF EXISTS SIGNATURE;

      COMMIT;
    `)
  },
}
